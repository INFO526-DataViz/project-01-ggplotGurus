---
title: "Seasonal & Temporal Trends: Exploring the weather forecasting accuracy across the U.S."
subtitle: "INFO 526 - Fall 2023 - Project 1"
author: "GGplot gurus- Swetha, Shalon, Deema, Kiwoon, Harsh"
title-slide-attributes:
  data-background-image: images/wf2.jpeg
  data-background-size: stretch
  data-background-opacity: "0.4"
  data-slide-number: none
format:
  revealjs:
    theme:  ['data/customtheming.scss']
    transition: convex
    background-transition: concave
  
editor: visual
execute:
  echo: false
  warning: false
---

```{r load packages}


library(tidyverse)
library(tidymodels)
library(ggridges)
library(plotly)
library(patchwork)
library(lubridate)
library(ggplot2)
library(ggmap)
library(sf)
library(usmap)

```

```{r}
#| label: setup
#| include: false

# Plot theme
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 11))

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618 
  )
```

```{r}
#| label: load-data
#| include: false
# Load data here

weather_forecasts <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/weather_forecasts.csv', show_col_types = FALSE)
cities <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/cities.csv', show_col_types = FALSE)
outlook_meanings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/outlook_meanings.csv', show_col_types = FALSE)

```

## **How Reliable Are Weather Forecasts?** {style="text-align: center; color: green"}

&nbsp;

&nbsp;

![](images/Slide2.jpg){fig-align="center" width="437"}

## Dataset and key variables {style="text-align: center"}

The dataset Weather_forecast_Accuracy includes 16 months of forecasts and observations from 167 cities.

1.  `weather_forecasts:`

    -   Date, City and State, Observed Temp and Forecast Temp

2.  `cities:`

    -   longitude, latitude, Cities, Temperature forecasting errors

3.   `outlook_meanings`:

## Question 1: How does the error in temperature prediction vary across the United States?  Can we identify clusters of cities with similar error patterns? {style="text-align: center"}

## Question 2: Geographic Seasonality in Temperature Forecasting Errors {style="text-align: center"}

&nbsp;

####                                           Do seasons impact Weather forecasting ?

```{r}


# Data Preparation
weather_forecasts$season <- case_when(
  month(weather_forecasts$date) %in% c(12, 1, 2) ~ "Winter",
  month(weather_forecasts$date) %in% c(3, 4, 5) ~ "Spring",
  month(weather_forecasts$date) %in% c(6, 7, 8) ~ "Summer",
  month(weather_forecasts$date) %in% c(9, 10, 11) ~ "Fall",
  TRUE ~ NA_character_
)

# Calculate temperature error
weather_forecasts$temp_error <- weather_forecasts$observed_temp - weather_forecasts$forecast_temp

# Aggregate data to get mean error by city and season
error_by_city_season <- weather_forecasts %>%
  group_by(city, state, season) %>%
  summarise(mean_temp_error = mean(temp_error, na.rm = TRUE), .groups = "drop") %>%
  left_join(cities, by = c("city", "state"))

# Convert the data to sf object
sf_error_by_city_season <- st_as_sf(error_by_city_season, coords = c("lon", "lat"), crs = 4326)

plot_seasonal_map <- function(data, season_name) {
  plot_usmap(data = data, values = "mean_temp_error", lines = "black") +
    scale_fill_gradient2(low = "blue", high = "red", midpoint = 0, 
                         name = "Mean Temp Error (Â°F)", label = scales::comma) +
    labs(title = paste("Geographic Seasonality in Temperature Forecasting Errors -", season_name),
         subtitle = "Mean temperature forecasting errors across U.S. states") +
    theme(legend.position = "right")
}

```

## Winter

```{r winter plot}


# For Winter
winter_data <- error_by_city_season %>% filter(season == "Winter")
plot_seasonal_map(winter_data, "Winter")
```

## Spring

```{r spring plot}
spring_data <- error_by_city_season %>% filter(season == "Spring")
plot_seasonal_map(spring_data, "Spring")
```

## Summer

```{r summer plot}
summer_data <- error_by_city_season %>% filter(season == "Summer")
plot_seasonal_map(summer_data, "Summer")
```

## Fall

```{r fall plot}
fall_data <- error_by_city_season %>% filter(season == "Fall")
plot_seasonal_map(fall_data, "Fall")
```

## Trend of Temperature Forecasting Errors over the years

```{r q2-viz1-plot2}

weather_forecasts %>%
  group_by(date) %>%
  summarise(mean_error = mean(temp_error, na.rm = TRUE)) %>%
  ggplot(aes(x=date, y=mean_error)) + 
  geom_line() + 
  labs(title="Trend of Temperature Forecasting Errors", 
       x="Date", y="Mean Error")
```
