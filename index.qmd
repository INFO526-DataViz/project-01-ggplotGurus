---
title: "USA Weather Forecast Accuracy Analysis"
subtitle: "INFO 526 - Project 1"
author: "ggplot gurus: Swetha, Shalon, Deema, Kiwoon, Harsh"
format: html
editor: visual
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE, 
                      message = FALSE)


```

```{r label: load-dataset, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggridges)
library(plotly)
library(patchwork)
library(lubridate)
library(ggplot2)
library(ggmap)
library(sf)
library(usmap)


weather_forecasts <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/weather_forecasts.csv', show_col_types = FALSE)
cities <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/cities.csv', show_col_types = FALSE)
outlook_meanings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/outlook_meanings.csv', show_col_types = FALSE)

```

## Abstract

In this project, our team is looking at a Weather Forecast Accuracy dataset provided by the USA National Weather Service. Our aim is to learn which areas of the U.S. struggle with weather prediction and the possible reasons why. Specifically, we focussed to answer to key questions: First, where in the U.S are the predictions most and least accurate? Second, are there certain times of the year when these predictions tend to be more or less accurate? We will also include in-depth discussions of our approach and method and include why our analysis was performed the way it was. By using heatmaps and other visuals, we hope to make our findings easy to understand. Our project aims to give insights on temperature predictions and help people understand where.\

## Introduction

Weather forecasts are a big deal. Every day, people and businesses depend on them to make all kinds of decisions. Think about it: Farmers use forecasts to decide when to plant crops. Airlines and trucking companies need them to plan routes. Even ordinary folks use them to plan picnics or decide on what to wear. Getting these predictions right can make a big difference.

So, how often are these forecasts on the mark? That's what we wanted to figure out. We picked a dataset called Weather Forecast Accuracy from the USA National Weather Service. This dataset gives us a peek into the weather predictions and what really happened over 16 months in 167 U.S. cities.

The dataset is split into three parts. The first part, weather_forecasts, is a big list with over 650,000 observations, giving us details like which city and state the forecast was for, what the expected and actual temperatures were, and when the prediction was made. The second part, cities, provides details about 236 cities, like where they are located. And the last part, outlook_meanings, helps us understand more about the types of forecasts.

With all this data in hand, our project wants to dig into where and when temperature forecasts tend to be most accurate or where they might miss the mark. By the end, we hope to give everyone a clearer idea of how much they can trust the weather forecasts they hear every day.

## Question 1: How does the error in temperature prediction vary across the United States? And can we identify clusters of cities with similar error patterns?

------------------------------------------------------------------------

### Introduction

Weather Forecast Accuracy is a significant domain of study, given the dependency of various industries, transportation, and even day-to-day activities on weather predictions. Precise forecasting can significantly impact logistics, energy sector decisions, agriculture, and more. This project's objective is to understand the accuracy of temperature forecasting across the U.S., examining which areas face challenges in weather prediction and delving into potential reasons for discrepancies. The data comprises 16 months of forecasts and observations from 167 cities, which serves as the foundation for this study.

### Approach

To assess the error in temperature prediction across the U.S. and identify clusters of cities with similar error patterns, we will utilize advanced geospatial data visualization techniques. Our methodology will involve the creation of a choropleth map of the United States, presenting a clear visual representation of temperature forecasting errors for cities.

1.  **Choropleth Map:** This map will be generated using the following variables:
    -   Latitude
    -   Longitude
    -   Cities
    -   Temperature forecasting errors
2.  **Temperature Forecasting Errors Calculation:** The errors will be determined using:
    -   Observed Temperature (Degrees Fahrenheit)
    -   Forecasted Temperature (Degrees Fahrenheit)
3.  **Clustering Cities Based on Regional Error Patterns:** To further dissect the data:
    -   Cities will be categorized by state.
    -   Regional averages of errors will be computed to identify patterns.

Incorporating a dark mode design will provide a modern, visually appealing look to our visualizations.

### Analysis

### Discussion

Upon examination of the provided plots:

1.  **Mean Temperature Prediction Error by State:**
    -   Certain states display a higher mean error in temperature prediction compared to others. For instance, AK (Alaska) has the highest error, followed by states like OR (Oregon), HI (Hawaii), and NV (Nevada). On the other end, states like SC (South Carolina) exhibit the least prediction error.
    -   This variation might be due to the geographical intricacies and climatic conditions of certain states, making them more challenging to predict.
2.  **Mean Temperature Prediction Error Across US Cities:**
    -   The scatter plot exhibits clusters of cities with similar temperature prediction errors based on their latitudinal and longitudinal positions.
    -   We notice cities in the northwest (higher latitudes and lower longitudes) tend to have higher errors. In contrast, cities in the southeast exhibit fewer errors.
    -   This clustering indicates potential regional factors influencing the accuracy of predictions. Regions with more volatile weather patterns or fewer weather observation resources might account for higher discrepancies.

In summary, while the U.S. National Weather Service provides extensive forecasting, certain regions and cities experience more significant temperature prediction errors than others. Understanding these discrepancies and their underlying causes can pave the way for improvements in forecasting models, ensuring more accurate and reliable predictions in the future.

## Question 2: **Geographic Seasonality in Temperature Forecasting Errors**

------------------------------------------------------------------------

### Introduction

In this data visualization project, we look into the "weather_forecasts" dataset from TidyTuesday. This dataset provides us with information about how accurate temperature forecasts are in different cities across the United States. It contains data on both observed temperatures, the temperatures that were predicted, the locations of these cities, and the time of year when these forecasts were made. Our primary aim is to examine how the average errors in temperature forecasts change depending on the season and location. This analysis can shed light on whether temperature forecasts are more accurate at certain times of the year and in specific geographic areas.

### Approach 

### Analysis

```{r q2-viz1-data}


# Data Preparation
weather_forecasts$season <- case_when(
  month(weather_forecasts$date) %in% c(12, 1, 2) ~ "Winter",
  month(weather_forecasts$date) %in% c(3, 4, 5) ~ "Spring",
  month(weather_forecasts$date) %in% c(6, 7, 8) ~ "Summer",
  month(weather_forecasts$date) %in% c(9, 10, 11) ~ "Fall",
  TRUE ~ NA_character_
)

# Calculate temperature error
weather_forecasts$temp_error <- weather_forecasts$observed_temp - weather_forecasts$forecast_temp

# Aggregate data to get mean error by city and season
error_by_city_season <- weather_forecasts %>%
  group_by(city, state, season) %>%
  summarise(mean_temp_error = mean(temp_error, na.rm = TRUE), .groups = "drop") %>%
  left_join(cities, by = c("city", "state"))

# Convert the data to sf object
sf_error_by_city_season <- st_as_sf(error_by_city_season, coords = c("lon", "lat"), crs = 4326)

plot_seasonal_map <- function(data, season_name) {
  plot_usmap(data = data, values = "mean_temp_error", lines = "black") +
    scale_fill_gradient2(low = "blue", high = "red", midpoint = 0, 
                         name = "Mean Temp Error (Â°F)", label = scales::comma) +
    labs(title = paste("Geographic Seasonality in Temperature Forecasting Errors -", season_name),
         subtitle = "Mean temperature forecasting errors across U.S. states") +
    theme(legend.position = "right")
}



```

```{r q2-viz1-plot}

# For Winter
winter_data <- error_by_city_season %>% filter(season == "Winter")
plot_seasonal_map(winter_data, "Winter")

# For Spring
spring_data <- error_by_city_season %>% filter(season == "Spring")
plot_seasonal_map(spring_data, "Spring")

# For Summer
summer_data <- error_by_city_season %>% filter(season == "Summer")
plot_seasonal_map(summer_data, "Summer")

# For Fall
fall_data <- error_by_city_season %>% filter(season == "Fall")
plot_seasonal_map(fall_data, "Fall")

```

### Discussion

The created maps reveal interesting insights into the seasonality of temperature forecasting errors. Here are some key observations:

1\. **Winter vs Summer :** The maps show that temperature forecasting errors tend to be higher in Winter compared to Summer. This could be due to the increased complexity of predicting temperature changes during the colder months.

2\. **Geographic Variations :** The maps also highlight regional variations in forecasting accuracy. Some states consistently exhibit lower errors, while others experience higher errors across all seasons. These variations may be influenced by local climate patterns and topography.

3\. **Seasonal Patterns :** The maps clearly illustrate the seasonal patterns of forecasting errors. For instance, errors tend to be lowest in Spring and Fall, which are transitional seasons with relatively stable weather conditions.

In conclusion, these visualizations provide valuable insights into the seasonality of temperature forecasting errors across different U.S. states. Understanding these patterns can be beneficial for improving weather forecasting models and enhancing preparedness for various weather conditions.
